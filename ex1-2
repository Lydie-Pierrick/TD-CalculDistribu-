#include <mpi.h>
#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <ctype.h>

int main(int argc, char** argv)
{
  if(argc < 2)
    return 1;

	MPI_Init(&argc, &argv);

	int wrank;
	MPI_Comm_rank(MPI_COMM_WORLD, &wrank);
  int world_size;
	MPI_Comm_size(MPI_COMM_WORLD, &world_size);

	srand(time(NULL) + wrank);

  int x = atoi(argv[1]);

  int i;
  int counter;
  int sum = 0;
  int receive = 0;

  for(i = 0; i < x; i++){
    counter = 0;
    while(1){
      int randomValue = rand()% 52 + 1;

      if(randomValue == 2){
        break;
      }
      counter ++;
    }
    sum += counter;

    MPI_Reduce(&sum, &receive, 1, MPI_INT, MPI_SUM, 0, MPI_COMM_WORLD);
  }

  if(wrank == 0){
    printf("Moyen : %f\n", (double)receive/x/world_size);
  }

	MPI_Finalize();

	return 0;
}
